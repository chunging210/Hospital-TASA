<!-- calendar -->
<link rel="stylesheet" href="/css/sysroom.css">

<div class="page-content">
    <div class="container-fluid vstack gap-3">
        <div class="card">
            <div class="card-header mx-4 mt-3">
                <div class="row align-items-center">
                    <!-- Title -->
                    <div class="col-auto text-branding align-middle">
                        <span class="material-icons">meeting_room</span>
                        會議室總覽
                    </div>

                    <div class="col-auto">
                        <select class="form-select" v-model="selectedDepartment" style="min-width: 180px;">
                            <option :value="null">請選擇分院...</option>
                            <option v-for="dept in departments" :key="dept.Id" :value="dept.Id">
                                {{ dept.Name }}
                            </option>
                        </select>
                    </div>

                    <!-- 大樓下拉 -->
                    <div class="col-auto">
                        <select class="form-select" v-model="selectedBuilding" :key="selectedDepartment"
                            style="min-width: 180px;">
                            <option value="">請選擇大樓...</option>
                            <option v-for="b in buildings" :key="b.Building" :value="b.Building">
                                {{ b.Building }}
                            </option>
                        </select>
                    </div>

                    <!-- 樓層下拉 -->
                    <div class="col-auto">
                        <select class="form-select" v-model="selectedFloor" :disabled="!selectedBuilding"
                            style="min-width: 180px;">
                            <option value="">請選擇樓層...</option>
                            <option v-for="f in floorOptions" :key="f" :value="f">
                                {{ f }}
                            </option>
                        </select>
                    </div>

                    <!-- 智慧搜尋按鈕 -->
                    <div class="col-auto ms-auto">
                        <button type="button" class="btn btn-outline-primary btn-rounded" data-bs-toggle="modal"
                            data-bs-target="#smartSearchModal" style="font-size: 14px;">
                            智慧搜尋
                        </button>
                    </div>
                </div>
            </div>

            <div class="card-body">

                <!-- 無資料 -->
                <div v-if="room.list.length === 0" class="text-center py-3 text-muted">
                    查無資料
                </div>

                <!-- 會議室卡片 -->
                <div v-else class="room-grid">
                    <div v-for="item in room.list" :key="item.Id" class="room-card">

                        <!-- Header -->
                        <div class="room-card-header">
                            <div class="room-name">{{ item.Name }}</div>
                            <div class="room-info">
                                {{ item.Building }} {{ item.Floor }} 樓 | {{ item.Number }}
                            </div>
                        </div>

                        <!-- 圖片/影片 -->
                        <div class="room-preview">
                            <!-- 圖片 -->
                            <div v-if="item.Images && item.Images.length > 0 && !room.isVideoFile(item.Images[item._imgIndex || 0])"
                                style="width: 100%; height: 100%; background-size: cover; background-position: center;"
                                :style="{ backgroundImage: `url('${item.Images[item._imgIndex || 0]}')` }">
                            </div>

                            <!-- ✅ 影片：加 controls autoplay muted -->
                            <video
                                v-else-if="item.Images && item.Images.length > 0 && room.isVideoFile(item.Images[item._imgIndex || 0])"
                                controls autoplay muted
                                style="width: 100%; height: 100%; object-fit: cover; background: #000; display: block;">
                                <source :src="item.Images[item._imgIndex || 0]" type="video/mp4">
                                你的瀏覽器不支援視訊播放
                            </video>

                            <!-- 無圖片 -->
                            <div v-else
                                style="width: 100%; height: 100%; background: #f0f0f0; display: flex; align-items: center; justify-content: center; color: #999;">
                                暫無圖片
                            </div>

                            <!-- 按鈕 -->
                            <button v-if="item.Images?.length > 1" class="carousel-btn prev"
                                @@click.stop="room.prevCardImage(item)">
                                ‹
                            </button>

                            <button v-if="item.Images?.length > 1" class="carousel-btn next"
                                @@click.stop="room.nextCardImage(item)">
                                ›
                            </button>
                        </div>

                        <!-- 內容 -->
                        <div class="room-card-body">
                            <div class="room-details">
                                <div class="detail-row">
                                    <span class="detail-label">人數</span>
                                    <span class="detail-value">{{ item.Capacity ?? '-' }} 人</span>
                                </div>

                                <div class="detail-row">
                                    <span class="detail-label">面積</span>
                                    <span class="detail-value">{{ item.Area ?? '-' }} ㎡</span>
                                </div>
                            </div>

                            <!-- 操作 -->
                            <div class="action-buttons mt-3">
                                <button class="btn btn-view" @@click.stop="room.openDetail(item.Id)">
                                    <span class="material-icons">visibility</span>
                                    了解更多
                                </button>
                                <button class="btn btn-edit" @@click.stop="room.goReserve(item)">
                                    <span class="material-icons">calendar_add_on</span>
                                    立即預約
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 分頁 -->
                <page ref="roompage" :per-page="6" :per-page-option="[6,9,12,18]" @@reload="room.getList">
                </page>
            </div>
        </div>
    </div>
</div>

<!-- 詳細 Modal（沿用你現有那份，Vue 已可正常吃到資料） -->
<partial name="_SysRoomDetail" />