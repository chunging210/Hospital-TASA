@{
    ViewData["Title"] = "會議室管理";
}

<link rel="stylesheet" href="/css/sysroom.css">

<div class="page-content" v-cloak>
    <div class="container-fluid vstack gap-3">
        <div class="card">
            <div class="card-header mx-4 mt-3">
                <div class="row d-flex align-items-center">
                    <div class="col-xl-auto col-sm-12 text-branding align-middle">
                        <span class="material-icons">room_preferences</span> 會議室管理
                    </div>

                    <div class="col-xl-5 col-sm-12">
                        <div class="search-box">
                            <div class="position-relative">
                                <input type="text" class="form-control" v-model="room.query.keyword"
                                       placeholder="搜尋會議室名稱...">
                                <span class="material-icons search-icon">search</span>
                            </div>
                        </div>
                    </div>

                    <div class="col-xl-auto col-sm-12 ms-auto">
                        <button type="button" @@click="room.getVM()" class="btn btn-primary d-flex align-items-center">
                            <span class="material-icons me-2">add</span> 新增會議室
                        </button>
                    </div>
                </div>
            </div>

            <!-- 會議室列表 -->
            <div class="card-body">

                <div v-if="room.list?.length === 0" class="text-center py-3 text-muted">
                    查無資料
                </div>

                <div v-else class="room-grid">
                    <div v-for="roomItem in room.list" :key="roomItem.Id" class="room-card">
                        <!-- 卡片頭 -->
                        <div class="room-card-header">
                            <div class="room-name">{{ roomItem.Name }}</div>
                            <div class="room-info">{{ roomItem.Building }} {{ roomItem.Floor }}樓 </div>
                        </div>

                        <!-- 卡片身 -->
                        <div class="room-card-body">
                            <!-- 輪播圖片/影片 -->
                            <div class="room-preview">
                                <!-- 圖片 -->
                                <img v-if="!isVideoFile(roomItem.Images[imageIndices[roomItem.Id] || 0])"
                                     :src="roomItem.Images && roomItem.Images.length > 0 ? roomItem.Images[imageIndices[roomItem.Id] || 0] : ''"
                                     style="width: 100%; height: 100%; object-fit: cover;" alt="會議室圖片">

                                <!-- 影片 -->
                                <video v-else controls
                                       style="width: 100%; height: 100%; object-fit: cover; background: #000;">
                                    <source
                                    :src="roomItem.Images && roomItem.Images.length > 0 ? roomItem.Images[imageIndices[roomItem.Id] || 0] : ''"
                                    type="video/mp4">
                                    你的瀏覽器不支援視訊播放
                                </video>

                                <!-- 導航按鈕 -->
                                <button v-if="roomItem.Images && roomItem.Images.length > 1"
                                    @@click="prevImage(roomItem.Id)" class="carousel-btn prev">
                                    &lt;
                                </button>
                                <button v-if="roomItem.Images && roomItem.Images.length > 1"
                                    @@click="nextImage(roomItem.Id)" class="carousel-btn next">
                                    &gt;
                                </button>
                            </div>

                            <!-- 詳細資訊 -->
                            <div class="room-details">
                                <div class="detail-row">
                                    <span class="detail-label">人數 </span>
                                    <span class="detail-value">{{ roomItem.Capacity }} 人</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">面積</span>
                                    <span class="detail-value">{{ roomItem.Area }} ㎡</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">開放狀態</span>
                                    <span class="status-badge"
                                          :class="getBookingSettingsClass(roomItem.BookingSettings)">
                                        {{ getBookingSettingsText(roomItem.BookingSettings) }}
                                    </span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">設備數量</span>
                                    <span class="detail-value">{{ roomItem.EquipmentCount || 0 }} 項設備</span>
                                </div>
                            </div>

                            <!-- 操作按鈕 -->
                            <div class="action-buttons">
                                <button class="btn btn-outline-primary" @@click="room.viewRoom(roomItem.Id)">
                                    <span class="material-icons icons me-1">visibility</span>
                                    檢視
                                </button>
                                <button class="btn btn-outline-primary" @@click="room.getVM(roomItem.Id)">
                                    <span class="material-icons icons me-1">edit</span>
                                    編輯
                                </button>
                                <button class="btn btn-outline-danger" @@click="room.deleteRoom(roomItem.Id)">
                                    <span class="material-icons icons me-1">clear</span>
                                    刪除
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <page ref="roompage" :per-page="6" :per-page-option="[6,9,12,18]" @@reload="room.getList">
                </page>
            </div>
        </div>
    </div>
</div>

<partial name="_SysRoomCreate" />
<partial name="_SysRoomDetail" />