@{
    ViewData["Title"] = "會議室管理";
}

<link rel="stylesheet" href="/css/sysroom.css">

<div class="page-content">
    <div class="container-fluid vstack gap-3">
        <div class="card">
            <div class="card-header">
                <div class="row">
                    <div class="col-xl-auto col-sm-12 text-branding align-middle">
                        <i class="mdi mdi-home-city"></i> 會議室管理
                    </div>

                    <div class="col-xl-6 col-sm-12">
                        <div class="input-group">
                            <span class="input-group-text bg-transparent border-end-0 rounded-start-pill">
                                <span class="material-icons text-muted">search</span>
                            </span>
                            <input v-model="room.query.keyword" @@keyup.enter="room.getList(1)"
                                class="form-control border-start-0 rounded-end-pill" placeholder="搜尋會議室名稱..." />
                            <button v-if="room.query.keyword" @@click="clearSearch()"
                                class="btn btn-outline-secondary border-start-0" type="button">
                                <span class="material-icons">clear</span>
                            </button>
                        </div>
                    </div>

                    <div class="col-xl-auto col-sm-12">
                        <button @@click="room.getList(1)"
                            class="btn btn-outline-primary me-2 d-flex align-items-center">
                            <span class="material-icons">search</span> 搜尋
                        </button>
                    </div>

                    <div class="col-xl-auto col-sm-12">
                        <button type="button" @@click="room.getVM()" class="btn btn-primary d-flex align-items-center">
                            <span class="material-icons me-2">add</span> 新增會議室
                        </button>
                    </div>
                </div>
            </div>

            <!-- 會議室列表 -->
            <div class="card-body">

                <div v-if="room.list?.length === 0" class="text-center py-3 text-muted">
                    查無資料
                </div>

                <div v-else class="room-grid">
                    <div v-for="roomItem in room.list" :key="roomItem.Id" class="room-card">
                        <!-- 卡片頭 -->
                        <div class="room-card-header">
                            <div class="room-name">{{ roomItem.Name }}</div>
                            <div class="room-info">{{ roomItem.Building }} {{ roomItem.Floor }}樓 </div>
                        </div>

                        <!-- 卡片身 -->
                        <div class="room-card-body">
                            <!-- 輪播圖片 -->
                            <div class="room-preview"
                                :style="{ backgroundImage: `url('${roomItem.Images && roomItem.Images.length > 0 ? roomItem.Images[imageIndices[roomItem.Id] || 0] : ''}')` }">
                                <button v-if="roomItem.Images && roomItem.Images.length > 1"
                                    @@click="prevImage(roomItem.Id)" class="carousel-btn prev">
                                    &lt;
                                </button>
                                <button v-if="roomItem.Images && roomItem.Images.length > 1"
                                    @@click="nextImage(roomItem.Id)" class="carousel-btn next">
                                    &gt;
                                </button>
                            </div>

                            <!-- 詳細資訊 -->
                            <div class="room-details">
                                <div class="detail-row">
                                    <span class="detail-label">容量</span>
                                    <span class="detail-value">{{ roomItem.Capacity }} 人</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">面積</span>
                                    <span class="detail-value">{{ roomItem.Area }} ㎡</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">使用狀態</span>
                                    <span class="status-badge" :class="getStatusClass(roomItem.Status)">
                                        {{ getStatusText(roomItem.Status) }}
                                    </span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">設備數量</span>
                                    <span class="detail-value">{{ roomItem.EquipmentCount || 0 }} 項設備</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">異常設備</span>
                                    <span class="detail-value"
                                        :class="roomItem.ErrorCount > 0 ? 'text-danger' : 'text-success'">
                                        {{ roomItem.ErrorCount || 0 }} 項
                                    </span>
                                </div>
                            </div>

                            <!-- 操作按鈕 -->
                            <div class="action-buttons">
                                <button class="btn btn-primary" @@click="room.viewRoom(roomItem.Id)">
                                    <i class="mdi mdi-eye"></i> 檢視
                                </button>
                                <button class="btn btn-warning" @@click="room.getVM(roomItem.Id)">
                                    <i class="mdi mdi-pencil"></i> 編輯
                                </button>
                                <button class="btn btn-danger" @@click="room.deleteRoom(roomItem.Id)">
                                    <i class="mdi mdi-trash-can"></i> 刪除
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <page ref="roompage" :per-page="6" :per-page-option="[6,9,12,18]" @@reload="room.getList">
                </page>
            </div>
        </div>
    </div>
</div>

<partial name="_SysRoomCreate" />
<partial name="_SysRoomDetail" />
<partial name="_SysRoomEdit" />